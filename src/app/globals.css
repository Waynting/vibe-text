@tailwind base;
@tailwind components;
@tailwind utilities;

/* Vibe Text - 直式文字編輯器樣式 */

/* Theme variables */
:root {
  --bg-primary: #ffffff;
  --bg-secondary: #ffffff;
  --text-primary: #000000;
  --text-secondary: #666666;
  --text-placeholder: #999999;
  --border-color: #e0e0e0;
  --border-dark: #333333;
  --button-hover: #f8f8f8;
  --scrollbar: #e0e0e0;
  --scrollbar-hover: #cccccc;
}

/* Dark theme */
[data-theme="dark"] {
  --bg-primary: #000000;
  --bg-secondary: #000000;
  --text-primary: #ffffff;
  --text-secondary: #999999;
  --text-placeholder: #666666;
  --border-color: #333333;
  --border-dark: #cccccc;
  --button-hover: #1a1a1a;
  --scrollbar: #333333;
  --scrollbar-hover: #555555;
}

/* Paper theme */
[data-theme="paper"] {
  --bg-primary: #e2c488;
  --bg-secondary: #f4e8d0;
  --text-primary: #000000;
  --text-secondary: #4a4a4a;
  --text-placeholder: #8b7355;
  --border-color: #8b7355;
  --border-dark: #000000;
  --button-hover: #d4c4a0;
  --scrollbar: #8b7355;
  --scrollbar-hover: #6b5a42;
}

/* Ultra-minimalist CSS for vertical Chinese text editor */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Songti SC', 'SimSun', 'Noto Serif CJK SC', serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Main container - full viewport */
@layer components {
  .app-container {
    @apply h-screen w-screen flex flex-col bg-[var(--bg-primary)];
  }

  /* Editor wrapper */
  .editor-wrapper {
    @apply flex-1;
    overflow: hidden;
  }

  /* Editor area - takes most of the screen */
  .editor-area {
    @apply flex-1 flex items-stretch justify-stretch p-0 overflow-hidden;
    height: 100%;
  }
  

  /* Editor container with title and content */
  .editor-container {
    @apply w-full h-full flex flex-row-reverse overflow-x-auto overflow-y-auto;
  }

  /* 文字方向為 LTR 時，標題在左側 */
  .editor-container.direction-ltr {
    @apply flex-row; /* Title on the left */
  }

  /* Title area - Chinese composition style */
  .title-area {
    @apply flex-shrink-0 w-auto h-full px-[15px] py-[15px] flex items-start justify-center;
    padding-bottom: 40px;
  }

  .title-text {
    writing-mode: vertical-rl;
    text-orientation: upright;
    @apply font-songti text-[29px] font-normal leading-[1.8] tracking-[0.1em] text-[var(--text-primary)];
    /* Fix Chinese punctuation positioning in vertical text */
    text-combine-upright: none;
    font-feature-settings: 'vpal' 1, 'vkrn' 1, 'vchw' 1;
    padding: 20px 15px 15px 15px; /* 上padding增加5px */
  }

  /* Vertical divider line */
  .title-divider {
    @apply flex-shrink-0 w-px bg-[var(--border-dark)] self-stretch;
    height: calc(100% - 30px);
    margin: 15px 0;
  }

  /* Content area */
  .content-area {
    @apply flex-1 p-0 relative flex items-start h-screen;
  }

  /* Vertical text editor */
  .editor-vertical {
    @apply font-songti leading-[1.8] tracking-[0.02em] outline-none border-none bg-transparent text-[var(--text-primary)] w-full block m-0;
    font-size: 17px; /* 預設字體大小 */
    height: 100vh;
    min-height: 100vh;
    max-height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 40px 60px; /* 文件編輯器風格的內邊距 */
    
    /* 確保換行正確顯示 */
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-word;
    
    /* 更好的中文字體渲染 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }


  /* 文字方向變體 */
  .editor-vertical.direction-rtl {
    writing-mode: horizontal-tb; /* 橫式書寫，直式排版 */
    direction: ltr;
    text-align: left;
  }

  .editor-vertical.direction-ltr {
    writing-mode: horizontal-tb; /* 標準橫式書寫 */
    direction: ltr;
    text-align: left;
  }

  /* 頂部工具欄 */
  .top-bar {
    @apply bg-[var(--bg-primary)] border-b border-[var(--border-color)] flex-shrink-0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .top-bar-row {
    @apply flex items-center gap-4 p-4;
  }

  .top-bar-section {
    @apply flex items-center gap-2;
  }

  .top-bar-metadata {
    @apply border-t border-[var(--border-color)] bg-[var(--button-hover)] p-4;
    animation: slideDown 0.2s ease-out;
  }

  .metadata-grid {
    @apply grid grid-cols-6 gap-4;
  }

  .metadata-group {
    @apply flex flex-col;
  }

  .metadata-group label {
    @apply text-sm text-[var(--text-secondary)] mb-1;
  }

  .title-input {
    @apply w-full text-xl font-medium bg-transparent border-none outline-none text-[var(--text-primary)];
    text-align: center;
  }

  .small-input {
    @apply text-base px-3 py-2 border border-[var(--border-color)] bg-transparent text-[var(--text-primary)] outline-none;
  }

  .small-input:focus {
    @apply border-[var(--text-primary)];
  }

  .word-count-display {
    @apply text-base text-[var(--text-secondary)];
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Buttons - ultra minimal */
  .btn {
    @apply bg-transparent border border-[var(--border-color)] py-2 px-4 font-songti text-[14px] cursor-pointer transition-all duration-200 text-[var(--text-primary)];
  }

  .btn:hover {
    @apply border-[var(--text-primary)];
  }

  .btn-primary {
    @apply border-[var(--text-primary)] bg-[var(--text-primary)] text-[var(--bg-primary)];
  }

  .btn-primary:hover {
    @apply border-[var(--bg-primary)] bg-[var(--text-primary)];
  }

  /* Word count display */
  .word-count {
    @apply text-xs text-[var(--text-secondary)] text-center py-2 border-t border-[var(--border-color)] mt-auto flex-shrink-0;
  }
  
  


  /* Theme toggle button */
  .theme-toggle {
    @apply w-full justify-center;
  }

  /* File path display */
  .file-path {
    @apply text-[11px] text-[var(--text-secondary)] py-1 break-all leading-[1.3] bg-black bg-opacity-5 px-2 py-[6px] rounded-[2px] font-mono;
  }

  [data-theme="dark"] .file-path {
    @apply bg-white bg-opacity-5;
  }
}

/* Force theme color inheritance */
[data-theme="light"] .editor-vertical,
[data-theme="light"] .title-text,
[data-theme="light"] .word-count {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

/* 淺色模式下的詳細資訊標題 */
[data-theme="light"] .metadata-group label {
  color: #333333;
}

[data-theme="light"] .btn:not(.btn-primary) {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

[data-theme="dark"] .editor-vertical,
[data-theme="dark"] .title-text,
[data-theme="dark"] .word-count {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

[data-theme="dark"] .btn:not(.btn-primary) {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

[data-theme="dark"] .app-container,

/* Paper theme color inheritance */
[data-theme="paper"] .editor-vertical,
[data-theme="paper"] .title-text,
[data-theme="paper"] .word-count {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

/* 牛皮紙模式下的詳細資訊標題 */
[data-theme="paper"] .metadata-group label {
  color: #3a3a3a;
}

[data-theme="paper"] .btn:not(.btn-primary) {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

[data-theme="paper"] .app-container,


/* Selection styling - 修復異常反白 */
.editor-vertical::selection {
  background: rgba(0, 0, 0, 0.1);
  color: inherit;
}

.editor-vertical::-moz-selection {
  background: rgba(0, 0, 0, 0.1);
  color: inherit;
}

[data-theme="dark"] .editor-vertical::selection {
  background: rgba(255, 255, 255, 0.1);
  color: inherit;
}

[data-theme="dark"] .editor-vertical::-moz-selection {
  background: rgba(255, 255, 255, 0.1);
  color: inherit;
}

[data-theme="paper"] .editor-vertical::selection {
  background: rgba(0, 0, 0, 0.1);
  color: inherit;
}

[data-theme="paper"] .editor-vertical::-moz-selection {
  background: rgba(0, 0, 0, 0.1);
  color: inherit;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
  /* 移動端頂部工具欄適配 */
  .top-bar {
    @apply text-sm;
  }
  
  .metadata-grid {
    @apply grid-cols-2 gap-2;
  }
  
  /* Mobile editor - full width */
  .editor-vertical {
    @apply text-[16px] leading-[1.5];
    padding: 20px;
    width: 100vw;
  }
  
  /* Mobile editor area - full width */
  .editor-area {
    @apply mr-0 !important;
  }
  
  /* Mobile buttons */
  .btn {
    @apply min-h-[36px] text-[14px] px-3;
  }
  
  /* Mobile app container */
  .app-container {
    @apply pb-16;
  }
}

@media (max-width: 480px) {
  /* Extra small mobile adjustments */
  .editor-vertical {
    @apply text-[15px] pr-12;
    padding: 15px 50px 15px 15px;
  }
  
  .btn {
    @apply text-[13px] min-h-[34px];
  }
  
  .top-bar-section {
    @apply gap-1;
  }
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  .btn:hover {
    @apply bg-transparent;
  }
  
  .btn:active {
    @apply bg-[var(--button-hover)];
  }
  
  /* Larger scrollbars for touch */
  .editor-vertical::-webkit-scrollbar {
    @apply w-3;
  }
}

/* Animation for collapsible sections */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Markdown Preview Styles */
.markdown-preview {
  @apply overflow-y-auto h-full p-4 text-[var(--text-primary)] font-songti;
  line-height: 1.8;
  letter-spacing: 0.05em;
  word-wrap: break-word;
  /* 使用 scroll behavior 讓滾動更順暢 */
  scroll-behavior: smooth;
  /* 確保預覽時有足夠的底部空間 */
  padding-bottom: 2rem;
  /* 確保 br 標籤正確顯示換行 */
  white-space: normal;
}

/* HtmlPrinter 組件樣式 */
.html-printer {
  @apply overflow-y-auto h-full p-4 text-[var(--text-primary)] font-songti;
  line-height: 1.8;
  letter-spacing: 0.05em;
  word-wrap: break-word;
  scroll-behavior: smooth;
  padding-bottom: 2rem;
  /* 使用正常的 white-space，讓瀏覽器處理 <br> 標籤 */
  white-space: normal;
}

/* 確保 br 標籤正確顯示換行 - 覆蓋 Tailwind preflight */
.html-printer br,
.markdown-preview br {
  display: block !important;
  margin: 0.5em 0 0.5em 0 !important;
  height: 0 !important;
  border: 0 !important;
  content: "" !important;
}

/* 另一種方法：使用 ::before 確保換行 */
.html-printer br::before,
.markdown-preview br::before {
  content: "\A" !important;
  white-space: pre !important;
}

.markdown-preview.direction-rtl {
  writing-mode: horizontal-tb; /* 橫式書寫 */
  direction: ltr;
  text-align: left;
  /* 直式文件風格的樣式 */
  padding: 2rem;
  line-height: 1.8;
}

.markdown-preview.direction-ltr {
  writing-mode: horizontal-tb;
  direction: ltr;
  text-align: left;
  padding: 2rem;
  line-height: 1.8;
}

/* 標準橫式標題和引用塊樣式 */
.markdown-preview.direction-rtl .markdown-h1,
.markdown-preview.direction-rtl .markdown-h2 {
  border-bottom: 2px solid var(--border-color);
  border-right: none;
  padding-bottom: 8px;
  padding-right: 0;
  margin-bottom: 16px;
  margin-right: 0;
}

.markdown-preview.direction-rtl .markdown-blockquote {
  border-left: 4px solid var(--border-color);
  border-top: none;
  padding-left: 16px;
  padding-top: 0;
  margin-left: 0;
  margin-top: 0;
}

/* Markdown 元素樣式 - 同時套用到 markdown-preview 和 html-printer */
.markdown-preview h1,
.html-printer h1 {
  @apply text-2xl font-bold mb-4 text-[var(--text-primary)];
  border-bottom: 2px solid var(--border-color);
  padding-bottom: 8px;
}

.markdown-preview h2,
.html-printer h2 {
  @apply text-xl font-bold mb-3 text-[var(--text-primary)];
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 6px;
}

.markdown-preview h3,
.html-printer h3 {
  @apply text-lg font-bold mb-2 text-[var(--text-primary)];
}

.markdown-preview p,
.html-printer p {
  @apply mb-4 leading-relaxed;
}

.markdown-preview ul, 
.markdown-preview ol,
.html-printer ul,
.html-printer ol {
  @apply mb-4 pl-6;
}

.markdown-preview li,
.html-printer li {
  @apply mb-1;
}

.markdown-preview blockquote,
.html-printer blockquote {
  @apply border-l-4 border-[var(--border-color)] pl-4 my-4 text-[var(--text-secondary)] italic;
}

.markdown-preview code,
.html-printer code {
  @apply bg-[var(--button-hover)] px-1 py-0.5 rounded text-sm font-mono;
}

.markdown-preview pre,
.html-printer pre {
  @apply mb-4 bg-[var(--button-hover)] rounded p-3 overflow-x-auto;
}

.markdown-preview pre code,
.html-printer pre code {
  @apply bg-transparent p-0;
}

.markdown-preview a,
.html-printer a {
  @apply text-blue-600 hover:text-blue-800 underline;
}

[data-theme="dark"] .markdown-preview a,
[data-theme="dark"] .html-printer a {
  @apply text-blue-400 hover:text-blue-300;
}

[data-theme="paper"] .markdown-preview a,
[data-theme="paper"] .html-printer a {
  @apply text-blue-800 hover:text-blue-900;
}

.markdown-preview strong,
.html-printer strong {
  @apply font-bold;
}

.markdown-preview em,
.html-printer em {
  @apply italic;
}

.markdown-preview hr,
.html-printer hr {
  @apply border-t border-[var(--border-color)] my-4;
}